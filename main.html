<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Minibar - Inventory System</title>

<style>
* {
  box-sizing: border-box;
}

body{
  background:#0b0f1a;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  margin:0;
  font-family:Arial;
  overflow: hidden;
}

/* CHARGER/CABLE BUTTONS */
.charger-buttons-container {
  position: absolute;
  top: 100px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 15px;
  z-index: 50;
  opacity: 0;
  visibility: hidden;
  transition: all 0.5s ease;
  pointer-events: none;
  flex-direction: row;
}

.charger-buttons-container.show {
  opacity: 1;
  visibility: visible;
  pointer-events: auto;
}

.charger-btn {
  background: rgba(30, 41, 59, 0.9);
  border: 2px solid #475569;
  color: #e5e7eb;
  padding: 8px 100px;
  border-radius: 10px;
  font-size: 10px;
  font-weight: bold;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 10px;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  min-width: 120px;
  justify-content: center;
}

.charger-btn:hover {
  background: rgba(51, 65, 85, 0.9);
  transform: translateY(-2px);
}

.charger-btn:active {
  transform: translateY(0);
}

.charger-btn.taken {
  background: rgba(239, 68, 68, 0.2);
  border-color: #ef4444;
  color: #fca5a5;
}

.charger-btn span:first-child {
  font-size: 20px;
}

@media (max-width: 768px) {
  .charger-buttons-container {
    top: 140px;
    flex-direction: row;
    gap: 10px;
  }
  
  .charger-btn {
    min-width: 140px;
    padding: 10px 15px;
    font-size: 14px;
  }
}

/* SETTINGS MENU - Hidden by default, only show on minibar page when no products open */
.settings-menu {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 300;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
}

.settings-menu.visible {
  opacity: 1;
  visibility: visible;
}

/* Hide settings when products are open */
.products-open .settings-menu {
  opacity: 0 !important;
  visibility: hidden !important;
  pointer-events: none !important;
}

.settings-button {
  background: rgba(30, 41, 59, 0.8);
  width: 50px;
  height: 50px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  border: 2px solid #475569;
  color: #e5e7eb;
  font-size: 24px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  transition: all 0.3s ease;
}

.settings-button:hover {
  background: rgba(51, 65, 85, 0.9);
  transform: scale(1.1);
}

.settings-panel {
  position: absolute;
  top: 60px;
  right: 0;
  background: rgba(15, 23, 42, 0.95);
  border-radius: 12px;
  padding: 15px;
  min-width: 200px;
  border: 2px solid #475569;
  box-shadow: 0 8px 24px rgba(0,0,0,0.4);
  opacity: 0;
  visibility: hidden;
  transform: translateY(-10px);
  transition: all 0.3s ease;
}

.settings-panel.show {
  opacity: 1;
  visibility: visible;
  transform: translateY(0);
}

.settings-item {
  padding: 10px;
  color: #e5e7eb;
  cursor: pointer;
  border-radius: 8px;
  transition: background 0.3s ease;
  display: flex;
  align-items: center;
  gap: 10px;
}

.settings-item:hover {
  background: rgba(51, 65, 85, 0.7);
}

.settings-item i {
  font-size: 18px;
}

/* LOGIN SCREEN */
.login-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #0b0f1a 0%, #1e293b 100%);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  padding: 20px;
  transition: opacity 0.7s ease;
}

.login-screen.hidden {
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
}

.login-container {
  background: rgba(15, 23, 42, 0.9);
  padding: 40px 30px;
  border-radius: 16px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
  border: 2px solid #475569;
  max-width: 400px;
  width: 90%;
  text-align: center;
}

.login-title {
  color: #e5e7eb;
  font-size: 28px;
  margin-bottom: 10px;
}

.login-subtitle {
  color: #94a3b8;
  font-size: 16px;
  margin-bottom: 30px;
}

.room-input {
  width: 100%;
  padding: 16px;
  font-size: 20px;
  background: #1e293b;
  border: 2px solid #475569;
  border-radius: 10px;
  color: #e5e7eb;
  text-align: center;
  margin-bottom: 20px;
  transition: all 0.3s ease;
}

.room-input:focus {
  outline: none;
  border-color: #60a5fa;
  box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.3);
}

.room-input::placeholder {
  color: #64748b;
}

.login-button {
  width: 100%;
  padding: 16px;
  background: #3b82f6;
  color: white;
  border: none;
  border-radius: 10px;
  font-size: 18px;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s ease;
}

.login-button:hover {
  background: #2563eb;
  transform: translateY(-2px);
}

.login-button:active {
  transform: translateY(0);
}

.error-message {
  color: #f87171;
  margin-top: 15px;
  font-size: 14px;
  min-height: 20px;
  visibility: hidden;
}

.error-message.show {
  visibility: visible;
}

.valid-rooms {
  color: #64748b;
  font-size: 14px;
  margin-top: 25px;
  line-height: 1.5;
}

.room-category {
  margin-bottom: 5px;
}

/* ROOM NUMBER DISPLAY - TOP CENTER */
.room-display {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  color: #e5e7eb;
  font-size: 24px;
  font-weight: bold;
  background: rgba(30, 41, 59, 0.8);
  padding: 10px 20px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  border: 2px solid #475569;
  z-index: 150;
  opacity: 0;
  visibility: hidden;
  transition: all 0.5s ease;
  display: flex;
  align-items: center;
  gap: 10px;
}

.room-display.show {
  opacity: 1;
  visibility: visible;
}

.casino-badge {
  background: #f59e0b;
  color: #0b0f1a;
  font-size: 12px;
  padding: 2px 8px;
  border-radius: 10px;
  font-weight: bold;
}

/* DONE BUTTON */
/* DONE BUTTON - MOVED TO TOP RIGHT */
.done-button {
  position: fixed;
  top: 20px;
  right: 20px; /* Changed from right: 90px to 20px */
  background: #10b981;
  color: white;
  border: none;
  border-radius: 12px;
  padding: 10px 20px;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
  z-index: 160;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  display: flex;
  align-items: center;
  gap: 8px;
}

.done-button.show {
  opacity: 1;
  visibility: visible;
}

.done-button:hover {
  background: #059669;
  transform: translateY(-2px);
}

.done-button:active {
  transform: translateY(0);
}

/* BACK ARROW */
.back-arrow {
  position: fixed;
  top: 20px;
  left: 20px;
  font-size: 32px;
  color: #e5e7eb;
  cursor: pointer;
  z-index: 200;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
  background: rgba(30, 41, 59, 0.8);
  width: 50px;
  height: 50px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  border: 2px solid #475569;
}

.back-arrow:hover {
  background: rgba(51, 65, 85, 0.9);
  transform: scale(1.1);
}

.back-arrow.visible {
  opacity: 1;
  visibility: visible;
}

/* Center container */
.center-container {
  position: relative;
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  opacity: 0;
  visibility: hidden;
  transition: all 0.7s ease;
}

.center-container.show {
  opacity: 1;
  visibility: visible;
}

/* minibar wrapper - PHONE SIZE */
.minibar{
  position:relative;
  width: 212px;      /* Phone size */
  height:290px;     /* Phone size */
  transition: all .7s ease;
}

/* fridge box */
.box{
  position:absolute;
  inset:0;
  background:#020617;
  border:3px solid #475569;
  box-shadow:0 0 25px rgba(0,0,0,.6);
  transition: all .7s ease;
}

/* INSIDE (hidden by door visually) */
.inside{
  position:absolute;
  top:14px;
  bottom:14px;
  left:14px;
  right:14px;
  background:#020617;
  border:2px solid #475569;
  transition: all .7s ease;
}

/* Single inside shelf - adjustable with --shelf-top variable */
.shelf{
  position:absolute;
  left:6px;
  right:6px;
  height:2px;
  background:#64748b;
  top: var(--shelf-top, 35%);
  transition: all .7s ease;
  z-index: 10;
}

/* Clickable areas above and below the shelf divider */
.shelf-area {
  position: absolute;
  left: 14px;
  right: 14px;
  cursor: pointer;
  z-index: 5;
  transition: background-color 0.3s ease;
  pointer-events: none;
}

.minibar.open .shelf-area:hover {
  background-color: rgba(255, 255, 255, 0.05);
}

.minibar.open .shelf-area {
  pointer-events: auto;
}

/* Area ABOVE the shelf divider */
.shelf-area.above {
  top: 14px;
  bottom: calc(100% - var(--shelf-top, 35%) + 7px);
}

/* Area BELOW the shelf divider */
.shelf-area.below {
  top: calc(var(--shelf-top, 35%) + 7px);
  bottom: 14px;
}

/* Door space areas - REMOVED since we're using shelves instead */
.door-space-area {
  display: none;
}

/* DOOR */
.door{
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:#1f2937;
  border:3px solid #6b7280;
  transform-origin:left center;
  transition:transform .7s ease;
  z-index: 2;
  transform-style: preserve-3d;
}

/* Door front (outside - NO shelves) */
.door-front {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: #1f2937;
  border: 3px solid #6b7280;
  backface-visibility: hidden;
}

/* Door back (inside - WITH shelves) */
.door-back {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: #020617;
  transform: rotateY(180deg);
  backface-visibility: hidden;
  border: 3px solid #6b7280;
  box-sizing: border-box;
}

/* Door inside border */
.door-inner{
  position:absolute;
  top:14px;
  bottom:14px;
  left:14px;
 right:14px;
  border:2px solid #9ca3af;
}

/* door shelves - only on the inside (door-back) */
.door-shelf{
  position:absolute;
  left:1px;
  right:1px;
  height:35px;
  background:#e5e7eb;
  transition: all .7s ease;
  cursor: default;
  pointer-events: none;
}

.minibar.open .door-shelf {
  cursor: pointer;
  pointer-events: auto;
}

/* TWO SHELVES on the door - between lines 1-2 and 3-4 */
.door-shelf.one{
  top: 32.5%; /* Between 25% and 40% = (25+40)/2 = 32.5% */
}    

.door-shelf.two{ 
  height: 40px;
  top: 82.5%; /* Between 75% and 90% = (75+90)/2 = 82.5% */
}    

/* Remove extra door shelves */
.door-shelf.three,
.door-shelf.four {
  display: none;
}

/* CLOSED - entire box is centered (no transform) */
.minibar:not(.open) {
  transform: translateX(0);
}

/* OPEN - left side of box is centered (move left by half width) */
.minibar.open {
  transform: translateX(75px); /* Half of 150px */
}

.minibar.open .door{
  transform:rotateY(-150deg);
}

/* PRODUCTS CONTAINER */
.products-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 100;
  opacity: 0;
  visibility: hidden;
  transition: all 0.7s ease;
  pointer-events: none;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 100px 20px 80px;
  gap: 25px;
  overflow-y: auto;
  box-sizing: border-box;
}

/* Individual product - FLEXIBLE HEIGHT */
.product {
  width: 180px;
  min-height: 50px;
  background: transparent;
  border-radius: 12px;
  overflow: visible;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  flex-direction: column;
  align-items: center;
  flex-shrink: 0;
  position: relative;
}

.product:hover {
  transform: scale(1.02);
}

/* Product name ABOVE the image */
.product-name {
  width: 100%;
  background: rgba(15, 23, 42, 0.9);
  color: #e5e7eb;
  font-size: 16px;
  font-weight: bold;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  padding: 8px 4px;
  margin-bottom: 8px;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  border: 1px solid #475569;
  min-height: 40px;
}

/* Product image - ORIGINAL SIZE */
.product-image {
  width: 100%;
  max-width: 180px;
  height: auto;
  object-fit: contain;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.4);
  border: 2px solid #475569;
  background: rgba(30, 41, 59, 0.9);
}

/* Quantity counter on product */
.product-quantity {
  position: absolute;
  top: -10px;
  right: -10px;
  background: #3b82f6;
  color: white;
  width: 30px;
  height: 30px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 14px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.4);
  border: 2px solid #1d4ed8;
  z-index: 10;
}

/* FIXED: SHOW PRODUCTS WHEN SHELF IS FOCUSED */
.above-focused .products-container,
.below-focused .products-container,
.shelf-1-door-focused .products-container,
.shelf-2-door-focused .products-container {
  opacity: 1 !important;
  visibility: visible !important;
  pointer-events: auto !important;
}

/* Background when shelf is focused */
.shelf-background {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(2, 6, 23, 0.95);
  opacity: 0;
  visibility: hidden;
  transition: all .7s ease;
  z-index: 90;
}

.shelf-background.visible {
  opacity: 1;
  visibility: visible;
}

/* PHONE FIX */
@media (max-width: 768px) {
  body {
    overflow-x: hidden;
    width: 100%;
  }
  
  .login-container {
    padding: 30px 20px;
  }
  
  .login-title {
    font-size: 24px;
  }
  
  .room-display {
    font-size: 20px;
    padding: 8px 16px;
    top: 15px;
  }
  
  .done-button {
    top: 15px;
    right: 15px;
    padding: 8px 16px;
    font-size: 14px;
  }
  
  .settings-button {
    width: 45px;
    height: 45px;
  }
  
  /* Make products fit screen */
  .product {
    width: 160px;
  }
  
  .product-name {
    font-size: 14px;
    padding: 6px 4px;
    min-height: 35px;
  }
  
  .product-image {
    max-width: 160px;
  }
  
  /* Center products with proper spacing */
  .products-container {
    padding-top: 90px;
    padding-bottom: 90px;
    padding-left: 10px;
    padding-right: 10px;
    gap: 20px;
  }
  
  /* Add invisible space at bottom */
  .products-container::after {
    content: '';
    height: 40px;
    width: 100%;
    flex-shrink: 0;
    visibility: hidden;
  }
}
</style>
</head>

<body>

<!-- CHARGER/CABLE BUTTONS -->
<div class="charger-buttons-container" id="chargerButtons">
  <button class="charger-btn" id="chargerBtn">
    <span>Charger</span>
  </button>
  <button class="charger-btn" id="cableBtn">
    <span>Charging Cable</span>
  </button>
</div>

<!-- SETTINGS MENU -->
<div class="settings-menu" id="settingsMenu">
  <div class="settings-button" id="settingsButton">‚ãÆ</div>
  <div class="settings-panel" id="settingsPanel">
    <div class="settings-item" id="viewInventory">
      <span>üìã</span>
      <span>·É®·Éî·Éï·É°·Éî·Éë·Éê</span>
    </div>
  </div>
</div>

<!-- LOGIN SCREEN -->
<div class="login-screen" id="loginScreen">
  <div class="login-container">
    <h1 class="login-title">·Éõ·Éò·Éú·Éò·Éë·Éê·É†·Éò</h1>
    <p class="login-subtitle">·É®·Éî·Éò·Éß·Éï·Éê·Éú·Éî·Éó ·Éù·Éó·Éê·ÉÆ·Éò·É° ·Éú·Éù·Éõ·Éî·É†·Éò</p>
    
    <input type="text" 
           class="room-input" 
           id="roomInput" 
           placeholder="(·Éõ·Éí. 101 ·Éê·Éú 2201)"
           maxlength="4"
           autofocus>
    
    <button class="login-button" id="loginButton">·É®·Éî·É°·Éï·Éö·Éê</button>
    <div style="margin-top: 25px;">
  <a href="minus.html" style="display: block; padding: 12px 20px; background: #ef4444; color: white; text-decoration: none; border-radius: 12px; border: 2px solid #000000; font-size: 17px; text-align: center; font-weight: bold;">
    ·Éõ·Éò·Éú·É£·É°·Éî·Éë·Éò
  </a>
</div>
    
    <div class="error-message" id="errorMessage"></div>
    
    <div class="valid-rooms">
      <div class="room-category">·Éù·Éó·Éê·ÉÆ·Éî·Éë·Éò</div>
      <div>·Éû·Éò·É†·Éï·Éî·Éö·Éò: 101-124</div>
      <div>·Éõ·Éî·Éù·É†·Éî: 201-224</div>
      <div>·Éõ·Éî·É°·Éê·Éõ·Éî: 301-324</div>
      <div>·Éõ·Éî·Éù·Éó·ÉÆ·Éî: 401-410</div>
      <div>·Éû·Éò·É†·Éï·Éî·Éö·Éò(·É´·Éï): 2201-2214</div>
      <div>·Éõ·Éî·Éù·É†·Éî(·É´·Éï): 3301-3314</div>
      <div style="margin-top: 10px; color: #fbbf24;">·Éô·Éê·Éñ·Éò·Éú·Éù·É° ·Éù·Éó·Éê·ÉÆ·Éî·Éë·Éò: 103, 105, 112, 203, 205, 212, 312, 401-410</div>
    </div>
    
    <a href="inventory.html" style="display: block; padding: 12px 12px; background: #157e3e; color: white; text-decoration: none; border-radius: 12px; border: 2px solid #000000; font-size: 17px; text-align: center; font-weight: bold;">
  ·É®·Éî·Éï·É°·Éî·Éë·Éê
</a>
  </div>
</div>

<!-- ROOM NUMBER DISPLAY - TOP CENTER -->
<div class="room-display" id="roomDisplay">
  <span>·Éù·Éó·Éê·ÉÆ·Éò</span>
  <span id="roomNumberDisplay">000</span>
  <div class="casino-badge" id="casinoBadge" style="display: none;">CASINO</div>
</div>

<!-- DONE BUTTON -->
<button class="done-button" id="doneButton">
  <span>‚úì</span>
  <span>Done</span>
</button>

<div class="back-arrow" id="backArrow">‚Üê</div>
<div class="shelf-background" id="shelfBackground"></div>

<!-- PRODUCTS CONTAINER -->
<div class="products-container" id="productsContainer">
  <!-- Products will be added here by JavaScript -->
</div>

<div class="center-container" id="centerContainer">
  <div class="minibar" id="bar" style="--shelf-top: 35%">

    <div class="box">

        <!-- INSIDE minibar -->
        <div class="inside">
          <!-- Clickable areas above and below the shelf -->
          <div class="shelf-area above" data-area="above"></div>
          <div class="shelf-area below" data-area="below"></div>
          
          <!-- Shelf divider line -->
          <div class="shelf"></div>
        </div>

        <!-- Door that hides everything -->
        <div class="door">
          <!-- Front (outside) - solid, no shelves -->
          <div class="door-front"></div>
          
          <!-- Back (inside) - with shelves -->
          <div class="door-back">
            <div class="door-inner">
              <!-- ONLY TWO SHELVES on the door -->
              <div class="door-shelf one" data-shelf="door-1"></div>
              <div class="door-shelf two" data-shelf="door-2"></div>
            </div>
          </div>
        </div>

    </div>

  </div>
</div>

<script>
// Inventory Manager for single-page app
const InventoryManager = {
  // Initialize inventory if not exists
  init() {
    if (!localStorage.getItem('minibarInventory')) {
      localStorage.setItem('minibarInventory', JSON.stringify({}));
    }
  },
  
  // Get all inventory
  getAllInventory() {
    const inventory = localStorage.getItem('minibarInventory');
    return inventory ? JSON.parse(inventory) : {};
  },
  
  // Get inventory for specific room
  getRoomInventory(roomNumber) {
    const allInventory = this.getAllInventory();
    if (allInventory[roomNumber]) {
      return allInventory[roomNumber];
    }
    return { products: {} };
  },
  
  // Update product count for a room
  updateProductCount(roomNumber, productId, productName, newCount) {
    const allInventory = this.getAllInventory();
    
    // Initialize room if not exists
    if (!allInventory[roomNumber]) {
      allInventory[roomNumber] = {
        products: {},
        lastUpdated: new Date().toISOString()
      };
    }
    
    // Update product count
    if (newCount > 0) {
      allInventory[roomNumber].products[productId] = {
        name: productName,
        count: newCount,
        lastUpdated: new Date().toISOString()
      };
    } else {
      // Remove product if count is 0
      delete allInventory[roomNumber].products[productId];
    }
    
    // Update timestamp
    allInventory[roomNumber].lastUpdated = new Date().toISOString();
    
    // Save to localStorage
    localStorage.setItem('minibarInventory', JSON.stringify(allInventory));
    
    return true;
  },
  
  // Get product count for a room
  getProductCount(roomNumber, productId) {
    const roomInventory = this.getRoomInventory(roomNumber);
    return roomInventory.products[productId] ? roomInventory.products[productId].count : 0;
  },
  
  // Clear all inventory data
  clearAll() {
    localStorage.setItem('minibarInventory', JSON.stringify({}));
    return true;
  },
  
  // Get summary of taken items by room
  getRoomSummary(roomNumber) {
    const roomInventory = this.getRoomInventory(roomNumber);
    const summary = [];
    
    Object.keys(roomInventory.products).forEach(productId => {
      const product = roomInventory.products[productId];
      summary.push(`${product.count} ${product.name}`);
    });
    
    return summary.length > 0 ? summary.join(', ') : 'No items taken';
  },
  
  // Get all rooms summary
  // Update the InventoryManager.getAllRoomsSummary() function:

// Get all rooms summary
getAllRoomsSummary() {
  const allInventory = this.getAllInventory();
  const summaries = [];
  
  Object.keys(allInventory).forEach(roomNumber => {
    const roomInventory = allInventory[roomNumber];
    const summaryItems = [];
    
    // Add minibar products
    Object.keys(roomInventory.products).forEach(productId => {
      const product = roomInventory.products[productId];
      // Check if it's a charger/cable (IDs 100, 101) or other product
      if (parseInt(productId) === CHARGER_ID || parseInt(productId) === CABLE_ID) {
        // Add charger/cable items
        summaryItems.push(`${product.count} ${product.name}`);
      } else if (product.count > 0) {
        // Add regular minibar products (only if count > 0)
        summaryItems.push(`${product.count} ${product.name}`);
      }
    });
    
    if (summaryItems.length > 0) {
      summaries.push({
        room: roomNumber,
        summary: summaryItems.join(', ')
      });
    }
  });
  
  // Sort by room number
  summaries.sort((a, b) => parseInt(a.room) - parseInt(b.room));
  
  return summaries;
},

// Also update getRoomSummary() function:
getRoomSummary(roomNumber) {
  const roomInventory = this.getRoomInventory(roomNumber);
  const summary = [];
  
  Object.keys(roomInventory.products).forEach(productId => {
    const product = roomInventory.products[productId];
    // Include ALL products (including chargers)
    summary.push(`${product.count} ${product.name}`);
  });
  
  return summary.length > 0 ? summary.join(', ') : 'No items taken';
},
};

// Initialize inventory
InventoryManager.init();

// DOM Elements
const loginScreen = document.getElementById("loginScreen");
const roomInput = document.getElementById("roomInput");
const loginButton = document.getElementById("loginButton");
const errorMessage = document.getElementById("errorMessage");
const centerContainer = document.getElementById("centerContainer");
const bar = document.getElementById("bar");
const backArrow = document.getElementById("backArrow");
const shelfBackground = document.getElementById("shelfBackground");
const productsContainer = document.getElementById("productsContainer");
const roomDisplay = document.getElementById("roomDisplay");
const roomNumberDisplay = document.getElementById("roomNumberDisplay");
const casinoBadge = document.getElementById("casinoBadge");
const doneButton = document.getElementById("doneButton");
const settingsMenu = document.getElementById("settingsMenu");
const settingsButton = document.getElementById("settingsButton");
const settingsPanel = document.getElementById("settingsPanel");
const viewInventory = document.getElementById("viewInventory");
const chargerButtons = document.getElementById("chargerButtons");
const chargerBtn = document.getElementById("chargerBtn");
const cableBtn = document.getElementById("cableBtn");

// Charger product IDs
const CHARGER_ID = 100;
const CABLE_ID = 101;

// Casino room numbers
const casinoRooms = [103, 105, 112, 203, 205, 212, 312];
const casinoRangeStart = 401;
const casinoRangeEnd = 410;

// Room validation ranges
const validRanges = [
  { start: 101, end: 124 },
  { start: 201, end: 224 },
  { start: 301, end: 324 },
  { start: 401, end: 410 },
  { start: 2201, end: 2214},
  { start: 3301, end: 3314},
  { start: 501, end: 502},
];

// PRODUCTS DATA with max counts
const baseProducts = {
  'above': [
    { id: 1, name: "Cola", image: "https://product.hstatic.net/1000282430/product/nuoc-ngot-coca-cola-nhat-500ml_f61289e9a50d41398d9711800846f9b0_grande.jpg", maxCount: 1 },
    { id: 2, name: "Redbull", image: "https://images.europroduct.ge/prod/7d1a791158/9a46837c83b04917aa53b2e5af25aed2_90376504.jpg?w=580", maxCount: 1 },
    { id: 3, name: "Chips", image: "https://m.media-amazon.com/images/I/61w6Gc8ox6L.jpg", maxCount: 1 },
    { id: 4, name: "Nuts", image: "https://cdn.2nabiji.ge/products/mitsis-thkhili-ola-mokhaluli-mariliani-300x300.webp", maxCount: 1 },
    { id: 5, name: "Honey", image: "https://www.trubeehoney.com/cdn/shop/products/MINI_1024x1024.jpg?v=1620842945", maxCount: 2 },
  ],
  
  'below': [
    { id: 7, name: "Water", image: "https://www.aversi.ge/uploads/matimg/293a37597e5b2ad1120984e131d7e82a.jpg", maxCount: 2 },
    { id: 8, name: "Heineken", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRfFQEReT42FKmj-5xxd6fmHEZhzop7IYXzsw&s", maxCount: 2 },
    { id: 9, name: "Fruit Juice", image: "https://nikorasupermarket.ge/modules/current_promotions/uploads/16794.png", maxCount: 2 },
    { id: 10, name: "nabeghlavi", image: "https://imagedelivery.net/d_EE26O5eWcJDRYn-qMBOg/3084d5f4-c3ec-40f4-05f5-c31c8cda5200/public", maxCount: 1 },
    { id: 11, name: "Tsinandali", image: "https://8000vintages.ge/images/thumbnails/1200/1800/detailed/18/keburia_tsinandali_2022.png", maxCount: 1 },
    { id: 12, name: "Khvanchkara", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcROcYIQbB-ZZSjivKhrV9qU3yTMucHdBEobAg&s", maxCount: 1 },
    { id: 13, name: "Saperavi", image: "https://8000vintages.ge/images/thumbnails/1200/1800/detailed/18/keburia_saperavi_2022.png", maxCount: 1 },
    { id: 14, name: "Chacha", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT1a0_3_lMeP_ps2j3oViU4CPpWHBrTlsiIHA&s", maxCount: 1 },
  ],

  'door-1': [
    { id: 30, name: "Rafaelo", image: "https://www.axonprofil.de/static/items/520/17264_1.jpg", maxCount: 3 },
    { id: 31, name: "M&M", image: "https://kcc.org.hk/wp-content/uploads/2023/09/MM20Chocolate20Peanut2037g.jpg", maxCount: 1 },
    { id: 32, name: "Snickers", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTSWZJpdqkpCmCBkEby1N1Sh0PeYbFvI8f7Ag&s", maxCount: 1 }
  ],
  
  'door-2': [
    { id: 40, name: "Jameson", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRzDOSSfqZfk056iMhz4Td1WpL6cglxeq9mLQ&s", maxCount: 1 },
    { id: 41, name: "Finlandia", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS2FeIzqvdhrRBCn1h18oijS9aurvuXndz7nA&s", maxCount: 1 },
    { id: 42, name: "Johnnie Walker", image: "https://www.raschvin.com/wp-content/uploads/2022/05/rSL000843.jpg", maxCount: 1 },
    { id: 43, name: "Henessy", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT1tipPf_0i53dVnnKwP0p2LwCVBHmlNwcbhg&s", maxCount: 1 },
    { id: 44, name: "Jack Daniels", image: "https://www.cebooze.com/app/uploads/2021/08/Jack-Daniel-Mini.jpg", maxCount: 1 },
    { id: 45, name: "Sarajishvili", image: "https://winetime.com.ua/storage/fab93e692c41c3ac030b6c147b5eed12.jpeg", maxCount: 1 },
  ]
};

// Casino-specific products
const casinoExtraProducts = {
  'below': [
    { id: 15, name: "moet", image: "https://cdn11.bigcommerce.com/s-9hu30/images/stencil/2048x2048/products/482/2416/moet_and_chandon_brut_imperial_187ml_mini_split__85900.1637085078.jpg?c=2", maxCount: 1 }
  ],
  
  'door-2': [
    { id: 46, name: "glen moray", image: "https://www.astorwines.com/images/items/01024.jpg", maxCount: 1 }
  ]
};

// Current state
let currentRoom = null;
let isCasinoRoom = false;
let currentShelfId = null;
let areProductsOpen = false;

// FUNCTIONS
function showChargerButtons() {
  chargerButtons.classList.add('show');
  updateChargerButtonStates();
}

function hideChargerButtons() {
  chargerButtons.classList.remove('show');
}

function updateChargerButtonStates() {
  const chargerCount = InventoryManager.getProductCount(currentRoom, CHARGER_ID);
  const cableCount = InventoryManager.getProductCount(currentRoom, CABLE_ID);
  
  // Update charger button
  if (chargerCount > 0) {
    chargerBtn.classList.add('taken');
    chargerBtn.innerHTML = `<span>üîå</span><span>Charger (${chargerCount})</span>`;
  } else {
    chargerBtn.classList.remove('taken');
    chargerBtn.innerHTML = `<span>üîå</span><span>Charger</span>`;
  }
  
  // Update cable button
  if (cableCount > 0) {
    cableBtn.classList.add('taken');
    cableBtn.innerHTML = `<span>üîó</span><span>Cable (${cableCount})</span>`;
  } else {
    cableBtn.classList.remove('taken');
    cableBtn.innerHTML = `<span>üîó</span><span>Charging Cable</span>`;
  }
}

function validateRoomNumber(roomNumber) {
  const roomNum = parseInt(roomNumber);
  
  if (isNaN(roomNum)) {
    return false;
  }
  
  // Accept both 3-digit and 4-digit numbers
  if (roomNumber.length !== 3 && roomNumber.length !== 4) {
    return false;
  }
  
  for (const range of validRanges) {
    if (roomNum >= range.start && roomNum <= range.end) {
      return true;
    }
  }
  
  return false;
}

function isCasinoRoomNumber(roomNumber) {
  const roomNum = parseInt(roomNumber);
  
  if (casinoRooms.includes(roomNum)) {
    return true;
  }
  
  if (roomNum >= casinoRangeStart && roomNum <= casinoRangeEnd) {
    return true;
  }
  
  return false;
}

function getProductsForRoom(roomNumber, shelfId) {
  const isCasino = isCasinoRoomNumber(roomNumber);
  let products = [...(baseProducts[shelfId] || [])];
  
  if (isCasino && casinoExtraProducts[shelfId]) {
    products = [...products, ...casinoExtraProducts[shelfId]];
  }
  
  return products;
}

function showProducts(shelfId) {
  // Hide charger buttons when products are open
  hideChargerButtons();
  
  // Hide settings menu when products are open
  settingsMenu.classList.remove('visible');
  document.body.classList.add('products-open');
  
  productsContainer.innerHTML = '';
  currentShelfId = shelfId;
  
  const products = getProductsForRoom(currentRoom, shelfId);
  
  if (products && products.length > 0) {
    products.forEach(product => {
      const productElement = createProductElement(product);
      productsContainer.appendChild(productElement);
    });
    
    doneButton.classList.add('show');
  } else {
    productsContainer.innerHTML = `
      <div class="product">
        <div class="product-name">No products</div>
        <div class="product-image" style="height: 100px; display: flex; align-items: center; justify-content: center; color: #64748b;">
          Empty shelf
        </div>
      </div>
    `;
    doneButton.classList.remove('show');
  }
  
  productsContainer.style.opacity = '1';
  productsContainer.style.visibility = 'visible';
  productsContainer.style.pointerEvents = 'auto';
  productsContainer.scrollTop = 0;
  backArrow.classList.add('visible');
  shelfBackground.classList.add('visible');
  areProductsOpen = true;
}

function createProductElement(product) {
  const productElement = document.createElement('div');
  productElement.className = 'product';
  productElement.setAttribute('data-product-id', product.id);
  productElement.setAttribute('data-product-name', product.name);
  productElement.setAttribute('data-max-count', product.maxCount);
  
  // Get current count from inventory
  const currentCount = InventoryManager.getProductCount(currentRoom, product.id);
  
  productElement.innerHTML = `
    <div class="product-name">${product.name}</div>
    <img src="${product.image}" alt="${product.name}" class="product-image">
    ${currentCount > 0 ? `<div class="product-quantity">${currentCount}</div>` : ''}
  `;
  
  productElement.addEventListener('click', () => {
    handleProductClick(product.id, product.name, product.maxCount, productElement);
  });
  
  return productElement;
}

function handleProductClick(productId, productName, maxCount, productElement) {
  // Get current count
  let currentCount = InventoryManager.getProductCount(currentRoom, productId);
  
  // Increment count (or reset to 0 if at max)
  if (currentCount < maxCount) {
    currentCount++;
  } else {
    currentCount = 0;
  }
  
  // Update in inventory
  InventoryManager.updateProductCount(currentRoom, productId, productName, currentCount);
  
  // Update display
  const quantityElement = productElement.querySelector('.product-quantity');
  if (currentCount > 0) {
    if (quantityElement) {
      quantityElement.textContent = currentCount;
    } else {
      productElement.innerHTML += `<div class="product-quantity">${currentCount}</div>`;
    }
  } else {
    if (quantityElement) {
      quantityElement.remove();
    }
  }
}

function showMinibar() {
  loginScreen.classList.add('hidden');
  settingsMenu.classList.add('visible');
  
  roomNumberDisplay.textContent = currentRoom;
  roomDisplay.classList.add('show');
  
  if (isCasinoRoom) {
    casinoBadge.style.display = 'block';
  } else {
    casinoBadge.style.display = 'none';
  }
  
  centerContainer.classList.add('show');
  backArrow.classList.add('visible');
  doneButton.classList.remove('show');
  
  // Show charger buttons
  showChargerButtons();
  
  setTimeout(() => {
    bar.classList.add('open');
  }, 500);
  
  areProductsOpen = false;
}


function showError(message) {
  errorMessage.textContent = message;
  errorMessage.classList.add('show');
  
  setTimeout(() => {
    errorMessage.classList.remove('show');
  }, 3000);
}

function closeProducts() {
  // Show charger buttons again
  showChargerButtons();
  
  // Show settings menu again
  settingsMenu.classList.add('visible');
  document.body.classList.remove('products-open');
  
  bar.classList.remove('above-focused', 'below-focused', 'shelf-1-door-focused', 'shelf-2-door-focused');
  backArrow.classList.add('visible');
  shelfBackground.classList.remove('visible');
  doneButton.classList.remove('show');
  
  productsContainer.style.opacity = '0';
  productsContainer.style.visibility = 'hidden';
  productsContainer.style.pointerEvents = 'none';
  setTimeout(() => {
    productsContainer.innerHTML = '';
  }, 300);
  
  areProductsOpen = false;
  currentShelfId = null;
}

function logout() {
  centerContainer.classList.remove('show');
  roomDisplay.classList.remove('show');
  bar.classList.remove('open');
  backArrow.classList.remove('visible');
  doneButton.classList.remove('show');
  settingsMenu.classList.remove('visible');
  document.body.classList.remove('products-open');
  
  // Hide charger buttons
  hideChargerButtons();
  
  currentRoom = null;
  isCasinoRoom = false;
  areProductsOpen = false;
  
  bar.classList.remove('above-focused', 'below-focused', 'shelf-1-door-focused', 'shelf-2-door-focused');
  shelfBackground.classList.remove('visible');
  productsContainer.style.opacity = '0';
  productsContainer.style.visibility = 'hidden';
  productsContainer.style.pointerEvents = 'none';
  productsContainer.innerHTML = '';
  
  loginScreen.classList.remove('hidden');
  roomInput.value = '';
  roomInput.focus();
  casinoBadge.style.display = 'none';
}

// EVENT HANDLERS
loginButton.addEventListener('click', () => {
  const roomNumber = roomInput.value.trim();
  
  if (!roomNumber) {
    showError('Please enter a room number');
    return;
  }
  
  if (!validateRoomNumber(roomNumber)) {
    showError('Invalid room number. Please enter a valid room');
    return;
  }
  
  currentRoom = roomNumber;
  isCasinoRoom = isCasinoRoomNumber(roomNumber);
  showMinibar();
});

roomInput.addEventListener('keypress', (e) => {
  if (e.key === 'Enter') {
    loginButton.click();
  }
});

roomInput.addEventListener('input', (e) => {
  e.target.value = e.target.value.replace(/\D/g, '');
  errorMessage.classList.remove('show');
});

bar.addEventListener("click", (e) => {
  if (e.target.classList.contains('box') || 
      e.target.classList.contains('door') ||
      e.target.classList.contains('door-front')) {
    bar.classList.toggle("open");
  }
});

document.querySelectorAll('.shelf-area').forEach(area => {
  area.addEventListener('click', (e) => {
    e.stopPropagation();
    
    if (!bar.classList.contains('open')) return;
    
    const areaType = area.getAttribute('data-area');
    
    bar.classList.remove('above-focused', 'below-focused', 'shelf-1-door-focused', 'shelf-2-door-focused');
    
    if (areaType === 'above') {
      bar.classList.add('above-focused');
      showProducts('above');
    } else if (areaType === 'below') {
      bar.classList.add('below-focused');
      showProducts('below');
    }
  });
});

document.querySelectorAll('.door-shelf').forEach(shelf => {
  shelf.addEventListener('click', (e) => {
    e.stopPropagation();
    
    if (!bar.classList.contains('open')) return;
    
    const shelfNumber = shelf.getAttribute('data-shelf');
    
    bar.classList.remove('above-focused', 'below-focused', 'shelf-1-door-focused', 'shelf-2-door-focused');
    
    switch(shelfNumber) {
      case 'door-1':
        bar.classList.add('shelf-1-door-focused'); 
        showProducts('door-1');
        break;
      case 'door-2':
        bar.classList.add('shelf-2-door-focused');
        showProducts('door-2');
        break;
    }
  });
});

// Charger button click handlers
chargerBtn.addEventListener('click', () => {
  let currentCount = InventoryManager.getProductCount(currentRoom, CHARGER_ID);
  
  // Toggle between 0 and 1
  if (currentCount < 1) {
    currentCount = 1;
  } else {
    currentCount = 0;
  }
  
  InventoryManager.updateProductCount(currentRoom, CHARGER_ID, "Charger", currentCount);
  updateChargerButtonStates();
});

cableBtn.addEventListener('click', () => {
  let currentCount = InventoryManager.getProductCount(currentRoom, CABLE_ID);
  
  // Toggle between 0 and 1
  if (currentCount < 1) {
    currentCount = 1;
  } else {
    currentCount = 0;
  }
  
  InventoryManager.updateProductCount(currentRoom, CABLE_ID, "Charging Cable", currentCount);
  updateChargerButtonStates();
});

doneButton.addEventListener('click', () => {
  closeProducts();
});

backArrow.addEventListener('click', () => {
  if (areProductsOpen) {
    closeProducts();
  } else {
    logout();
  }
});

shelfBackground.addEventListener('click', () => {
  closeProducts();
});

settingsButton.addEventListener('click', (e) => {
  e.stopPropagation();
  settingsPanel.classList.toggle('show');
});

document.addEventListener('click', (e) => {
  if (!settingsButton.contains(e.target) && !settingsPanel.contains(e.target)) {
    settingsPanel.classList.remove('show');
  }
});

viewInventory.addEventListener('click', () => {
  // Save current room state before navigating
  if (currentRoom) {
    localStorage.setItem('lastRoom', currentRoom);
    localStorage.setItem('lastRoomState', JSON.stringify({
      room: currentRoom,
      isCasino: isCasinoRoom,
      timestamp: new Date().toISOString()
    }));
  }
  
  // Open inventory in same tab
  window.location.href = 'inventory.html';
});

// Add this function to restore state when returning from inventory
function checkForReturnFromInventory() {
  const lastRoomState = localStorage.getItem('lastRoomState');
  if (lastRoomState) {
    const state = JSON.parse(lastRoomState);
    const lastRoom = localStorage.getItem('lastRoom');
    
    // Check if we're returning within 5 minutes
    const stateTime = new Date(state.timestamp);
    const currentTime = new Date();
    const timeDiff = (currentTime - stateTime) / (1000 * 60); // difference in minutes
    
    if (timeDiff < 5 && lastRoom) { // Return within 5 minutes
      // Restore the room
      currentRoom = lastRoom;
      isCasinoRoom = state.isCasino;
      showMinibar();
      
      // Clear the saved state
      localStorage.removeItem('lastRoomState');
      localStorage.removeItem('lastRoom');
    }
  }
}

// Call this when the page loads
window.addEventListener('load', () => {
  roomInput.focus();
  checkForReturnFromInventory();
});
</script>

</body>
</html>