<!DOCTYPE html>
<html>
<head>
  <script src="nozoom.js"></script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Product Totals</title>
<style>
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: Arial, sans-serif;
  background: #0b0f1a;
  color: #e5e7eb;
  min-height: 100vh;
}

.totals-page {
  padding: 20px;
  background: linear-gradient(135deg, #0b0f1a 0%, #1e293b 100%);
}

.totals-container {
  max-width: 800px;
  margin: 60px auto 0;
  background: rgba(15, 23, 42, 0.9);
  padding: 30px;
  border-radius: 16px;
  border: 2px solid #475569;
}

.totals-title {
  color: #e5e7eb;
  font-size: 32px;
  margin-bottom: 30px;
  text-align: center;
}

.totals-controls {
  display: flex;
  gap: 15px;
  margin-bottom: 30px;
  flex-wrap: wrap;
}

.back-button, .export-totals-button {
  padding: 12px 20px;
  border: none;
  border-radius: 10px;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s ease;
}

.back-button {
  background: #3b82f6;
  color: white;
  text-decoration: none;
  display: inline-block;
}

.back-button:hover {
  background: #2563eb;
  transform: translateY(-2px);
}

.export-totals-button {
  background: #10b981;
  color: white;
}

.export-totals-button:hover {
  background: #059669;
  transform: translateY(-2px);
}

.totals-list {
  background: rgba(30, 41, 59, 0.5);
  border-radius: 12px;
  padding: 20px;
  min-height: 300px;
  max-height: 600px;
  overflow-y: auto;
}

.product-category {
  margin-bottom: 25px;
}

.category-title {
  font-size: 20px;
  color: #60a5fa;
  margin-bottom: 15px;
  padding-bottom: 8px;
  border-bottom: 2px solid #475569;
  display: flex;
  align-items: center;
  gap: 10px;
}

.product-item-total {
  background: rgba(15, 23, 42, 0.8);
  padding: 15px;
  margin-bottom: 10px;
  border-radius: 10px;
  border: 2px solid #475569;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: all 0.3s ease;
}

.product-item-total.minibar {
  border-left: 4px solid #8b5cf6;
}

.product-item-total.charger {
  border-left: 4px solid #3b82f6;
}

.product-name-total {
  font-size: 16px;
  color: #e5e7eb;
  display: flex;
  align-items: center;
  gap: 10px;
}

.product-count-total {
  background: rgba(59, 130, 246, 0.2);
  color: #93c5fd;
  padding: 8px 16px;
  border-radius: 20px;
  font-size: 18px;
  font-weight: bold;
  border: 2px solid #3b82f6;
}

.no-totals {
  text-align: center;
  padding: 40px;
  color: #94a3b8;
}

.total-summary {
  background: rgba(30, 41, 59, 0.8);
  color: #e5e7eb;
  padding: 15px;
  border-radius: 12px;
  border: 2px solid #475569;
  margin-top: 20px;
  text-align: center;
}

.summary-item {
  display: flex;
  justify-content: space-between;
  margin-bottom: 10px;
  padding-bottom: 10px;
  border-bottom: 1px solid #475569;
}

.summary-item:last-child {
  border-bottom: none;
  margin-bottom: 0;
  padding-bottom: 0;
}

.summary-label {
  color: #cbd5e1;
}

.summary-value {
  color: #60a5fa;
  font-weight: bold;
}

.summary-value.total {
  color: #10b981;
  font-size: 20px;
}

.room-count-header {
  position: fixed;
  top: 20px;
  right: 20px;
  background: rgba(30, 41, 59, 0.8);
  color: #e5e7eb;
  padding: 8px 16px;
  border-radius: 20px;
  border: 2px solid #475569;
  font-size: 14px;
  font-weight: bold;
  z-index: 100;
}

@media (max-width: 768px) {
  .totals-container {
    margin-top: 80px;
    padding: 20px;
  }
  
  .totals-title {
    font-size: 24px;
  }
  
  .product-name-total {
    font-size: 14px;
  }
  
  .product-count-total {
    font-size: 16px;
    padding: 6px 12px;
  }
  
  .room-count-header {
    top: 15px;
    right: 15px;
    font-size: 12px;
  }
}

/* Animation for notifications */
@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slideOut {
  from {
    opacity: 1;
    transform: translateY(0);
  }
  to {
    opacity: 0;
    transform: translateY(-20px);
  }
}
</style>
</head>

<body class="totals-page">

<div class="room-count-header" id="roomCount">·Éù·Éó·Éê·ÉÆ·Éî·Éë·Éò: 0</div>

<div class="totals-container">
  <h1 class="totals-title">üìä ·É°·É£·Éö ·Éû·É†·Éù·Éì·É£·É•·É¢·Éî·Éë·Éò</h1>
  
  <div class="totals-controls">
    <a href="inventory.html" class="back-button">‚Üê ·É£·Éô·Éê·Éú</a>
    <button class="export-totals-button" id="exportTotals">·Éî·É•·É°·Éû·Éù·É†·É¢·Éò</button>
  </div>
  
  <div class="totals-list" id="totalsList">
    <!-- Product totals will be loaded here -->
  </div>
  
  <div class="total-summary" id="totalSummary">
    <!-- Summary will be loaded here -->
  </div>
</div>

<script>
// Define charger product IDs (must match main.html)
const CHARGER_ID = 100;
const CABLE_ID = 101;

const InventoryManager = {
  getAllInventory() {
    const inventory = localStorage.getItem('minibarInventory');
    return inventory ? JSON.parse(inventory) : {};
  },
  
  getProductTotals() {
    const allInventory = this.getAllInventory();
    const productTotals = {};
    let totalRooms = 0;
    let totalProducts = 0;
    let totalMinibarProducts = 0;
    let totalChargerProducts = 0;
    
    Object.keys(allInventory).forEach(roomNumber => {
      const roomInventory = allInventory[roomNumber];
      const products = roomInventory.products || {};
      
      let hasProducts = false;
      
      Object.keys(products).forEach(productId => {
        const product = products[productId];
        const productIdNum = parseInt(productId);
        
        if (product.count > 0) {
          hasProducts = true;
          
          // Initialize product in totals if not exists
          if (!productTotals[productId]) {
            productTotals[productId] = {
              name: product.name,
              count: 0,
              type: (productIdNum === CHARGER_ID || productIdNum === CABLE_ID) ? 'charger' : 'minibar'
            };
          }
          
          // Add to totals
          productTotals[productId].count += product.count;
          totalProducts += product.count;
          
          if (productIdNum === CHARGER_ID || productIdNum === CABLE_ID) {
            totalChargerProducts += product.count;
          } else {
            totalMinibarProducts += product.count;
          }
        }
      });
      
      if (hasProducts) {
        totalRooms++;
      }
    });
    
    return {
      productTotals,
      totalRooms,
      totalProducts,
      totalMinibarProducts,
      totalChargerProducts
    };
  },
  
  exportTotals() {
    const totals = this.getProductTotals();
    const { productTotals, totalRooms, totalProducts, totalMinibarProducts, totalChargerProducts } = totals;
    
    // Convert productTotals object to array and sort
    const productsArray = Object.keys(productTotals)
      .map(productId => ({
        id: productId,
        ...productTotals[productId]
      }))
      .sort((a, b) => {
        // Sort by type first (minibar then charger), then by count descending
        if (a.type !== b.type) {
          return a.type === 'minibar' ? -1 : 1;
        }
        return b.count - a.count;
      });
    
    // Create CSV content
    const csvContent = [
      ['Product Name', 'Type', 'Total Quantity'],
      ...productsArray.map(product => [
        product.name,
        product.type === 'charger' ? 'Charger' : 'Minibar',
        product.count
      ]),
      [],
      ['Summary', '', ''],
      ['Total Rooms', '', totalRooms],
      ['Total Minibar Products', '', totalMinibarProducts],
      ['Total Charger Products', '', totalChargerProducts],
      ['Total All Products', '', totalProducts]
    ].map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
    
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);
    link.setAttribute('href', url);
    link.setAttribute('download', `product_totals_${new Date().toISOString().split('T')[0]}.csv`);
    link.style.visibility = 'hidden';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    return true;
  }
};

document.addEventListener('DOMContentLoaded', function() {
  const totalsList = document.getElementById('totalsList');
  const totalSummary = document.getElementById('totalSummary');
  const roomCount = document.getElementById('roomCount');
  const exportTotalsButton = document.getElementById('exportTotals');
  
  function loadTotals() {
    const totals = InventoryManager.getProductTotals();
    const { productTotals, totalRooms, totalProducts, totalMinibarProducts, totalChargerProducts } = totals;
    
    roomCount.textContent = `·Éù·Éó·Éê·ÉÆ·Éî·Éë·Éò: ${totalRooms}`;
    
    if (Object.keys(productTotals).length === 0) {
      totalsList.innerHTML = `
        <div class="no-totals">
          <p>·ÉØ·Éî·É†·ÉØ·Éî·É†·Éù·Éë·Éò·Éó ·Éê·É† ·Éê·É†·Éò·É° ·Éû·É†·Éù·Éì·É£·É•·É¢·Éî·Éë·Éò</p>
          <p>·É®·Éî·Éì·Éò ·Éù·Éó·Éê·ÉÆ·É®·Éò ·Éì·Éê ·É®·Éî·Éê·Éõ·Éù·É¨·Éõ·Éî</p>
        </div>
      `;
      totalSummary.innerHTML = '';
      return;
    }
    
    // Convert productTotals object to array and separate by type
    const productsArray = Object.keys(productTotals)
      .map(productId => ({
        id: productId,
        ...productTotals[productId]
      }))
      .sort((a, b) => b.count - a.count); // Sort by count descending
    
    const minibarProducts = productsArray.filter(p => p.type === 'minibar');
    const chargerProducts = productsArray.filter(p => p.type === 'charger');
    
    totalsList.innerHTML = '';
    
    // Display minibar products
    if (minibarProducts.length > 0) {
      const minibarCategory = document.createElement('div');
      minibarCategory.className = 'product-category';
      minibarCategory.innerHTML = `
        <div class="category-title">
          <span>üçæ ·Éõ·Éò·Éú·Éò·Éë·Éê·É†·Éò·É° ·Éû·É†·Éù·Éì·É£·É•·É¢·Éî·Éë·Éò</span>
        </div>
      `;
      
      minibarProducts.forEach(product => {
        const productElement = document.createElement('div');
        productElement.className = 'product-item-total minibar';
        productElement.innerHTML = `
          <div class="product-name-total">
            ${product.name}
          </div>
          <div class="product-count-total">
            ${product.count}
          </div>
        `;
        minibarCategory.appendChild(productElement);
      });
      
      totalsList.appendChild(minibarCategory);
    }
    
    // Display charger products
    if (chargerProducts.length > 0) {
      const chargerCategory = document.createElement('div');
      chargerCategory.className = 'product-category';
      chargerCategory.innerHTML = `
        <div class="category-title">
          <span>üîå ·É©·Éê·É†·ÉØ·Éî·É†·Éî·Éë·Éò</span>
        </div>
      `;
      
      chargerProducts.forEach(product => {
        const productElement = document.createElement('div');
        productElement.className = 'product-item-total charger';
        productElement.innerHTML = `
          <div class="product-name-total">
            ${product.name}
          </div>
          <div class="product-count-total">
            ${product.count}
          </div>
        `;
        chargerCategory.appendChild(productElement);
      });
      
      totalsList.appendChild(chargerCategory);
    }
    
    // Display summary
    totalSummary.innerHTML = `
      <div class="summary-item">
        <span class="summary-label">·Éù·Éó·Éê·ÉÆ·Éî·Éë·Éò:</span>
        <span class="summary-value">${totalRooms}</span>
      </div>
        <span class="summary-label total">·É°·É£·Éö ·Éû·É†·Éù·Éì·É£·É•·É¢·Éî·Éë·Éò:</span>
        <span class="summary-value total">${totalProducts}</span>
      </div>
    `;
  }
  
  function showNotification(message, color = '#10b981') {
    const existingNotification = document.querySelector('.custom-notification');
    if (existingNotification) existingNotification.remove();
    
    const notification = document.createElement('div');
    notification.className = 'custom-notification';
    notification.style.cssText = `
      position: fixed;
      top: 80px;
      right: 20px;
      background: ${color}20;
      color: ${color === '#10b981' ? '#a7f3d0' : '#e9d5ff'};
      padding: 12px 20px;
      border-radius: 8px;
      border: 2px solid ${color}60;
      z-index: 1000;
      font-size: 14px;
      font-weight: bold;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      animation: slideIn 0.3s ease;
    `;
    
    notification.textContent = message;
    document.body.appendChild(notification);
    
    setTimeout(() => {
      notification.style.animation = 'slideOut 0.3s ease';
      setTimeout(() => notification.remove(), 300);
    }, 2000);
  }
  
  exportTotalsButton.addEventListener('click', () => {
    InventoryManager.exportTotals();
    showNotification('·É¢·Éù·É¢·Éê·Éö·Éî·Éë·Éò ·Éî·É•·É°·Éû·Éù·É†·É¢·Éò·É†·Éî·Éë·É£·Éö·Éò·Éê', '#10b981');
  });
  
  loadTotals();
  setInterval(loadTotals, 10000);
});
</script>
<script>
// Add this to prevent double-tap zoom on ALL pages
document.addEventListener('DOMContentLoaded', function() {
  // Method 1: Prevent zoom on double tap
  let lastTouchEnd = 0;
  
  document.addEventListener('touchend', function(event) {
    const now = Date.now();
    if (now - lastTouchEnd <= 300) {
      event.preventDefault();
    }
    lastTouchEnd = now;
  }, false);
  
  // Method 2: Prevent zoom gestures
  document.addEventListener('gesturestart', function(event) {
    event.preventDefault();
  });
  
  // Method 3: Prevent multiple touch zoom
  document.addEventListener('touchstart', function(event) {
    if (event.touches.length > 1) {
      event.preventDefault();
    }
  }, { passive: false });
  
  // Method 4: Disable zoom completely on iOS
  document.addEventListener('touchmove', function(event) {
    if (event.scale !== 1) {
      event.preventDefault();
    }
  }, { passive: false });
});
</script>
</body>
</html>