<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Minibar - Inventory</title>
<style>
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: Arial, sans-serif;
  background: #0b0f1a;
  color: #e5e7eb;
}

.inventory-page {
  padding: 20px;
  min-height: 100vh;
  background: linear-gradient(135deg, #0b0f1a 0%, #1e293b 100%);
}

.inventory-container {
  max-width: 800px;
  margin: 60px auto 0;
  background: rgba(15, 23, 42, 0.9);
  padding: 30px;
  border-radius: 16px;
  border: 2px solid #475569;
}

.inventory-title {
  color: #e5e7eb;
  font-size: 32px;
  margin-bottom: 30px;
  text-align: center;
}

.inventory-controls {
  display: flex;
  gap: 15px;
  margin-bottom: 30px;
  flex-wrap: wrap;
}

.clear-button, .export-button, .sort-button {
  padding: 12px 20px;
  border: none;
  border-radius: 10px;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s ease;
}

.clear-button {
  background: #ef4444;
  color: white;
}

.clear-button:hover {
  background: #dc2626;
  transform: translateY(-2px);
}

.export-button {
  background: #3b82f6;
  color: white;
}

.export-button:hover {
  background: #2563eb;
  transform: translateY(-2px);
}

.sort-button {
  background: #8b5cf6;
  color: white;
}

.sort-button:hover {
  background: #7c3aed;
  transform: translateY(-2px);
}

.sort-button.active {
  background: #7c3aed;
  box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.3);
}

.inventory-list {
  background: rgba(30, 41, 59, 0.5);
  border-radius: 12px;
  padding: 20px;
  min-height: 300px;
  max-height: 500px;
  overflow-y: auto;
}

.inventory-room-item {
  background: rgba(15, 23, 42, 0.8);
  padding: 20px;
  margin-bottom: 15px;
  border-radius: 12px;
  border: 2px solid #475569;
  transition: all 0.3s ease;
  cursor: pointer;
  user-select: none;
  position: relative;
  overflow: hidden;
}

.inventory-room-item::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 0;
  height: 100%;
  background: linear-gradient(90deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.3) 100%);
  transition: width 0.3s ease;
  z-index: 1;
}

.inventory-room-item.swiping::before {
  width: 100%;
}

.inventory-room-item.green {
  background: rgba(16, 185, 129, 0.15);
  border-color: #10b981;
  box-shadow: 0 4px 15px rgba(16, 185, 129, 0.2);
  opacity: 0.8;
}

.inventory-room-item.green .room-number {
  color: #10b981;
  font-weight: bold;
}

.inventory-room-item.green .room-summary {
  color: #a7f3d0;
}

.inventory-room-item.green .checkmark {
  opacity: 1;
  transform: scale(1);
}

.inventory-room-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.room-number {
  color: #60a5fa;
  font-weight: bold;
  font-size: 22px;
  display: flex;
  align-items: center;
  gap: 10px;
}

.checkmark {
  color: #10b981;
  font-size: 18px;
  opacity: 0;
  transform: scale(0);
  transition: all 0.3s ease;
}

.room-summary {
  color: #cbd5e1;
  font-size: 16px;
  width: 100%;
}

.product-list {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 8px;
}

.product-item {
  background: rgba(30, 41, 59, 0.6);
  padding: 6px 12px;
  border-radius: 8px;
  border: 1px solid #475569;
  font-size: 14px;
  color: #cbd5e1;
}

.no-inventory {
  text-align: center;
  padding: 40px;
  color: #94a3b8;
}

.back-arrow {
  position: fixed;
  top: 20px;
  left: 20px;
  font-size: 18px;
  color: #e5e7eb;
  cursor: pointer;
  background: rgba(30, 41, 59, 0.8);
  padding: 10px 15px;
  border-radius: 12px;
  border: 2px solid #475569;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 5px;
  z-index: 100;
  text-decoration: none;
}

.back-arrow:hover {
  background: rgba(51, 65, 85, 0.9);
  transform: translateX(-3px);
}

.swipe-hint {
  text-align: center;
  color: #94a3b8;
  font-size: 14px;
  margin-bottom: 20px;
  padding: 10px;
  background: rgba(30, 41, 59, 0.3);
  border-radius: 8px;
}

.room-count {
  position: fixed;
  top: 20px;
  right: 20px;
  background: rgba(30, 41, 59, 0.8);
  color: #e5e7eb;
  padding: 8px 16px;
  border-radius: 20px;
  border: 2px solid #475569;
  font-size: 14px;
  font-weight: bold;
  z-index: 100;
}

.swipe-feedback {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: flex-start;
  padding-left: 20px;
  color: #10b981;
  font-size: 16px;
  font-weight: bold;
  opacity: 0;
  transform: translateX(-20px);
  transition: all 0.3s ease;
  z-index: 1;
  pointer-events: none;
}

.inventory-room-item.swiping .swipe-feedback {
  opacity: 1;
  transform: translateX(0);
}

.swipe-progress {
  position: absolute;
  bottom: 0;
  left: 0;
  height: 3px;
  background: #10b981;
  border-radius: 0 0 12px 12px;
  width: 0%;
  transition: width 0.2s ease;
}

.total-items {
  background: rgba(30, 41, 59, 0.8);
  color: #e5e7eb;
  padding: 8px 16px;
  border-radius: 20px;
  border: 2px solid #475569;
  font-size: 14px;
  margin-top: 15px;
  text-align: center;
}

.last-updated {
  font-size: 12px;
  color: #94a3b8;
  margin-top: 5px;
}

.sort-indicator {
  display: inline-block;
  margin-left: 10px;
  font-size: 12px;
  color: #8b5cf6;
  background: rgba(139, 92, 246, 0.2);
  padding: 2px 8px;
  border-radius: 12px;
  border: 1px solid #8b5cf6;
}

@media (max-width: 768px) {
  .inventory-container {
    margin-top: 80px;
    padding: 20px;
  }
  
  .inventory-title {
    font-size: 24px;
  }
  
  .room-number {
    font-size: 18px;
  }
  
  .product-item {
    font-size: 12px;
    padding: 4px 8px;
  }
  
  .back-arrow {
    top: 15px;
    left: 15px;
    padding: 8px 12px;
  }
  
  .room-count {
    top: 15px;
    right: 15px;
    font-size: 12px;
  }
}
</style>
</head>

<body class="inventory-page">

<a href="main.html" class="back-arrow">â† áƒ£áƒ™áƒáƒœ</a>

<div class="room-count" id="roomCount">áƒáƒ—áƒáƒ®áƒ”áƒ‘áƒ˜: 0</div>

<div class="inventory-container">
  <h1 class="inventory-title">ğŸ“‹ áƒ¨áƒ”áƒ•áƒ¡áƒ”áƒ‘áƒ</h1>
  
  <div class="swipe-hint">
    áƒ’áƒáƒ£áƒ¡áƒ•áƒ˜ áƒ›áƒáƒ áƒ¯áƒ•áƒœáƒ˜áƒ• áƒáƒ—áƒáƒ®áƒ¡
  </div>
  
  <div class="inventory-controls">
    <button class="clear-button" id="clearButton">áƒ’áƒáƒ¡áƒ£áƒ¤áƒ—áƒáƒ•áƒ”áƒ‘áƒ</button>
    <button class="export-button" id="exportButton">áƒ”áƒ¥áƒ¡áƒáƒáƒ áƒ¢áƒ˜</button>
    <button class="sort-button" id="sortButton">áƒ“áƒáƒšáƒáƒ’áƒ”áƒ‘áƒ</button>
  </div>
  
  <div class="inventory-list" id="inventoryList">
    <!-- Inventory items will be loaded here -->
  </div>
  
  <div class="total-items" onclick="window.location.href='totals.html'" id="totalItems">áƒ¡áƒ£áƒš áƒáƒ áƒáƒ“áƒ£áƒ¥áƒ¢áƒ”áƒ‘áƒ˜: 0</div>
</div>
<script>
const InventoryManager = {
  getAllInventory() {
    const inventory = localStorage.getItem('minibarInventory');
    return inventory ? JSON.parse(inventory) : {};
  },
  
  getMarkedRooms() {
    const markedRooms = localStorage.getItem('markedRooms');
    return markedRooms ? JSON.parse(markedRooms) : [];
  },
  
  markRoom(roomNumber) {
    const markedRooms = this.getMarkedRooms();
    if (!markedRooms.includes(roomNumber)) {
      markedRooms.push(roomNumber);
      localStorage.setItem('markedRooms', JSON.stringify(markedRooms));
    }
    return true;
  },
  
  unmarkRoom(roomNumber) {
    const markedRooms = this.getMarkedRooms();
    const index = markedRooms.indexOf(roomNumber);
    if (index > -1) {
      markedRooms.splice(index, 1);
      localStorage.setItem('markedRooms', JSON.stringify(markedRooms));
    }
    return true;
  },
  
  isRoomMarked(roomNumber) {
    const markedRooms = this.getMarkedRooms();
    return markedRooms.includes(roomNumber);
  },
  
  getAllRoomsSummary(sortBy = 'time') {
    const allInventory = this.getAllInventory();
    const markedRooms = this.getMarkedRooms();
    const summaries = [];
    let totalProducts = 0;
    
    Object.keys(allInventory).forEach(roomNumber => {
      const roomInventory = allInventory[roomNumber];
      const products = roomInventory.products || {};
      const productItems = [];
      let roomProductCount = 0;
      
      Object.keys(products)
        .sort((a, b) => parseInt(a) - parseInt(b))
        .forEach(productId => {
          const product = products[productId];
          if (product.count > 0) {
            productItems.push({
              name: product.name,
              count: product.count
            });
            roomProductCount += product.count;
          }
        });
      
      if (productItems.length > 0) {
        totalProducts += roomProductCount;
        summaries.push({
          room: roomNumber,
          products: productItems,
          totalCount: roomProductCount,
          isMarked: markedRooms.includes(roomNumber),
          lastUpdated: roomInventory.lastUpdated || new Date().toISOString(),
          timestamp: new Date(roomInventory.lastUpdated || new Date()).getTime()
        });
      }
    });
    
    const sortedSummaries = this.sortSummaries(summaries, sortBy);
    
    return {
      summaries: sortedSummaries,
      totalProducts,
      sortBy
    };
  },
  
  sortSummaries(summaries, sortBy) {
    if (sortBy === 'time') {
      return summaries.sort((a, b) => {
        if (a.isMarked && !b.isMarked) return 1;
        if (!a.isMarked && b.isMarked) return -1;
        return b.timestamp - a.timestamp;
      });
    } else if (sortBy === 'room') {
      return summaries.sort((a, b) => parseInt(a.room) - parseInt(b.room));
    } else if (sortBy === 'products') {
      return summaries.sort((a, b) => {
        if (a.isMarked && !b.isMarked) return 1;
        if (!a.isMarked && b.isMarked) return -1;
        return b.totalCount - a.totalCount;
      });
    }
    return summaries;
  },
  
  clearAll() {
    localStorage.setItem('minibarInventory', JSON.stringify({}));
    localStorage.setItem('markedRooms', JSON.stringify([]));
    return true;
  },
  
  exportInventory() {
    const allInventory = this.getAllInventory();
    const markedRooms = this.getMarkedRooms();
    const exportData = [];
    
    Object.keys(allInventory).forEach(roomNumber => {
      const roomInventory = allInventory[roomNumber];
      const products = roomInventory.products || {};
      const productList = [];
      
      Object.keys(products)
        .sort((a, b) => parseInt(a) - parseInt(b))
        .forEach(productId => {
          const product = products[productId];
          if (product.count > 0) {
            productList.push(`${product.count} ${product.name}`);
          }
        });
      
      if (productList.length > 0) {
        exportData.push({
          room: roomNumber,
          products: productList.join(', '),
          marked: markedRooms.includes(roomNumber),
          date: roomInventory.lastUpdated || new Date().toISOString()
        });
      }
    });
    
    const csvContent = [
      ['Room', 'Products', 'Marked', 'Date'],
      ...exportData.map(item => [
        item.room,
        item.products,
        item.marked ? 'Yes' : 'No',
        new Date(item.date).toLocaleDateString('ka-GE')
      ])
    ].map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
    
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    const url = URL.createObjectURL(blob);
    link.setAttribute('href', url);
    link.setAttribute('download', `minibar_inventory_${new Date().toISOString().split('T')[0]}.csv`);
    link.style.visibility = 'hidden';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    return true;
  }
};

document.addEventListener('DOMContentLoaded', function() {
  const inventoryList = document.getElementById('inventoryList');
  const clearButton = document.getElementById('clearButton');
  const exportButton = document.getElementById('exportButton');
  const sortButton = document.getElementById('sortButton');
  const roomCount = document.getElementById('roomCount');
  const totalItems = document.getElementById('totalItems');
  
  let currentSort = localStorage.getItem('inventorySort') || 'time';
  const sortMethods = ['time', 'room', 'products'];
  let sortIndex = sortMethods.indexOf(currentSort);
  
  updateSortButton();
  
  function loadInventory() {
    const result = InventoryManager.getAllRoomsSummary(currentSort);
    const { summaries, totalProducts } = result;
    inventoryList.innerHTML = '';
    
    if (summaries.length === 0) {
      inventoryList.innerHTML = `
        <div class="no-inventory">
          <p>áƒ¯áƒ”áƒ áƒ¯áƒ”áƒ áƒáƒ‘áƒ˜áƒ— áƒáƒ  áƒ“áƒáƒ’áƒ˜áƒ›áƒáƒ¢áƒ”áƒ‘áƒ˜áƒ áƒáƒ—áƒáƒ®áƒ˜</p>
          <p>áƒ¨áƒ”áƒ“áƒ˜ áƒáƒ—áƒáƒ®áƒ¨áƒ˜ áƒ“áƒ áƒ¨áƒ”áƒáƒ›áƒáƒ¬áƒ›áƒ”</p>
        </div>
      `;
      roomCount.textContent = 'áƒáƒ—áƒáƒ®áƒ”áƒ‘áƒ˜: 0';
      totalItems.textContent = 'áƒ¡áƒ£áƒš áƒáƒ áƒáƒ“áƒ£áƒ¥áƒ¢áƒ”áƒ‘áƒ˜: 0';
      return;
    }
    
    roomCount.textContent = `áƒáƒ—áƒáƒ®áƒ”áƒ‘áƒ˜: ${summaries.length}`;
    totalItems.textContent = `áƒ¡áƒ£áƒš áƒáƒ áƒáƒ“áƒ£áƒ¥áƒ¢áƒ”áƒ‘áƒ˜: ${totalProducts}`;
    
    summaries.forEach(item => {
      const roomItem = document.createElement('div');
      roomItem.className = `inventory-room-item ${item.isMarked ? 'green' : ''}`;
      roomItem.setAttribute('data-room', item.room);
      
      const productItemsHTML = item.products.map(product => 
        `<span class="product-item">${product.count} ${product.name}</span>`
      ).join('');
      
      const lastUpdated = new Date(item.lastUpdated);
      const timeAgo = getTimeAgo(lastUpdated);
      
      roomItem.innerHTML = `
        <div class="swipe-feedback">${item.isMarked ? 'Unmark' : 'Mark as Green âœ“'}</div>
        <div class="swipe-progress"></div>
        <div class="inventory-room-header">
          <span class="room-number">
            ${item.isMarked ? '<span class="checkmark">âœ“</span>' : ''}
            áƒáƒ—áƒáƒ®áƒ˜ ${item.room}
            ${currentSort !== 'time' ? `<span class="sort-indicator">${getSortIndicator()}</span>` : ''}
          </span>
        </div>
        <div class="room-summary">
          <div class="product-list">
            ${productItemsHTML}
          </div>
          <div class="last-updated">
            ğŸ•’ ${timeAgo} â€¢ áƒ¡áƒ£áƒš: ${item.totalCount} áƒáƒ áƒáƒ“áƒ£áƒ¥áƒ¢áƒ˜
          </div>
        </div>
      `;
      
      addSwipeEvents(roomItem, item.room);
      inventoryList.appendChild(roomItem);
    });
  }
  
  function getSortIndicator() {
    switch(currentSort) {
      case 'room': return 'áƒáƒ—áƒáƒ®áƒ˜';
      case 'products': return 'áƒ áƒáƒáƒ“áƒ”áƒœáƒáƒ‘áƒ';
      default: return '';
    }
  }
  
  function getTimeAgo(date) {
    const now = new Date();
    const diffMs = now - date;
    const diffMins = Math.floor(diffMs / 60000);
    const diffHours = Math.floor(diffMs / 3600000);
    const diffDays = Math.floor(diffMs / 86400000);
    
    if (diffMins < 1) return 'áƒáƒ®áƒšáƒ';
    if (diffMins < 60) return `${diffMins} áƒ¬áƒ£áƒ—áƒ˜áƒ¡ áƒ¬áƒ˜áƒœ`;
    if (diffHours < 24) return `${diffHours} áƒ¡áƒáƒáƒ—áƒ˜áƒ¡ áƒ¬áƒ˜áƒœ`;
    if (diffDays < 7) return `${diffDays} áƒ“áƒ¦áƒ˜áƒ¡ áƒ¬áƒ˜áƒœ`;
    return date.toLocaleDateString('ka-GE');
  }
  
  function addSwipeEvents(roomItem, roomNumber) {
    let touchStartX = 0;
    let touchEndX = 0;
    
    roomItem.addEventListener('touchstart', (e) => {
      touchStartX = e.touches[0].clientX;
      roomItem.classList.add('swiping');
    });
    
    roomItem.addEventListener('touchmove', (e) => {
      touchEndX = e.touches[0].clientX;
      const swipeDistance = touchEndX - touchStartX;
      const progress = Math.min(Math.max(swipeDistance / 100, 0), 1);
      const progressBar = roomItem.querySelector('.swipe-progress');
      progressBar.style.width = `${progress * 100}%`;
      
      if (swipeDistance > 30) {
        roomItem.style.transform = `translateX(${Math.min(swipeDistance * 0.5, 50)}px)`;
      }
    });
    
    roomItem.addEventListener('touchend', () => {
      const swipeDistance = touchEndX - touchStartX;
      roomItem.classList.remove('swiping');
      roomItem.style.transform = '';
      
      const progressBar = roomItem.querySelector('.swipe-progress');
      progressBar.style.width = '0%';
      
      if (swipeDistance > 100) {
        handleSwipeRight(roomNumber, roomItem);
      }
    });
  }
  
  function handleSwipeRight(roomNumber, roomElement) {
    const isCurrentlyMarked = InventoryManager.isRoomMarked(roomNumber);
    
    if (isCurrentlyMarked) {
      InventoryManager.unmarkRoom(roomNumber);
      roomElement.classList.remove('green');
      showNotification(`áƒáƒ—áƒáƒ®áƒ˜ ${roomNumber} áƒ›áƒáƒ®áƒ¡áƒœáƒ˜áƒšáƒ˜áƒ`, '#3b82f6');
    } else {
      InventoryManager.markRoom(roomNumber);
      roomElement.classList.add('green');
      showNotification(`áƒáƒ—áƒáƒ®áƒ˜ ${roomNumber} áƒ›áƒáƒœáƒ˜áƒ¨áƒœáƒ£áƒšáƒ˜áƒ âœ“`, '#10b981');
    }
    
    setTimeout(() => {
      loadInventory();
    }, 300);
  }
  
  function updateSortButton() {
    const sortNames = {
      'time': 'áƒ“áƒ áƒ â°',
      'room': 'áƒáƒ—áƒáƒ®áƒ˜ ğŸ”¢', 
      'products': 'áƒ áƒáƒáƒ“áƒ”áƒœáƒáƒ‘ ğŸ“Š'
    };
    sortButton.textContent = `áƒ“áƒáƒšáƒáƒ’áƒ”áƒ‘áƒ: ${sortNames[currentSort]}`;
  }
  
  function cycleSortMethod() {
    sortIndex = (sortIndex + 1) % sortMethods.length;
    currentSort = sortMethods[sortIndex];
    localStorage.setItem('inventorySort', currentSort);
    updateSortButton();
    loadInventory();
    showNotification(`áƒ“áƒáƒšáƒáƒ’áƒ”áƒ‘áƒ: ${getSortName(currentSort)}`, '#8b5cf6');
  }
  
  function getSortName(method) {
    const names = {
      'time': 'áƒ“áƒ áƒ',
      'room': 'áƒáƒ—áƒáƒ®áƒ˜áƒ¡ áƒœáƒáƒ›áƒ”áƒ áƒ˜',
      'products': 'áƒáƒ áƒáƒ“áƒ£áƒ¥áƒ¢áƒ”áƒ‘áƒ˜áƒ¡ áƒ áƒáƒáƒ“áƒ”áƒœáƒáƒ‘áƒ'
    };
    return names[method] || method;
  }
  
  function showNotification(message, color = '#10b981') {
    const existingNotification = document.querySelector('.custom-notification');
    if (existingNotification) existingNotification.remove();
    
    const notification = document.createElement('div');
    notification.className = 'custom-notification';
    notification.style.cssText = `
      position: fixed;
      top: 80px;
      right: 20px;
      background: ${color}20;
      color: ${color === '#10b981' ? '#a7f3d0' : '#e9d5ff'};
      padding: 12px 20px;
      border-radius: 8px;
      border: 2px solid ${color}60;
      z-index: 1000;
      font-size: 14px;
      font-weight: bold;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      animation: slideIn 0.3s ease;
    `;
    
    notification.textContent = message;
    document.body.appendChild(notification);
    
    setTimeout(() => {
      notification.style.animation = 'slideOut 0.3s ease';
      setTimeout(() => notification.remove(), 300);
    }, 2000);
  }
  
  clearButton.addEventListener('click', () => {
    if (confirm('áƒ“áƒáƒ áƒ¬áƒ›áƒ£áƒœáƒ”áƒ‘áƒ£áƒšáƒ˜ áƒ®áƒáƒ ? áƒ§áƒ•áƒ”áƒšáƒáƒ¤áƒ”áƒ áƒ˜ áƒ¬áƒáƒ˜áƒ¨áƒšáƒ”áƒ‘áƒ')) {
      InventoryManager.clearAll();
      loadInventory();
      showNotification('áƒ§áƒ•áƒ”áƒšáƒáƒ¤áƒ”áƒ áƒ˜ áƒ¬áƒáƒ¨áƒšáƒ˜áƒšáƒ˜áƒ', '#ef4444');
    }
  });
  
  exportButton.addEventListener('click', () => {
    InventoryManager.exportInventory();
    showNotification('áƒ˜áƒœáƒ•áƒ”áƒœáƒ¢áƒáƒ áƒ˜ áƒ”áƒ¥áƒ¡áƒáƒáƒ áƒ¢áƒ˜áƒ áƒ”áƒ‘áƒ£áƒšáƒ˜áƒ', '#3b82f6');
  });
  
  sortButton.addEventListener('click', cycleSortMethod);
  
  loadInventory();
  setInterval(loadInventory, 10000);
});
</script>

</body>
</html>